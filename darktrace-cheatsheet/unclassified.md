# Unclassified

## Unclassified

CoercerMS\_DFSNM Fixed #42, Coercing HTTP Authentications did not work properly 6 months ago MS\_EFSR Fixed #42, Coercing HTTP Authentications did not work properly 6 months ago MS\_EVEN added DCERPC mode (#56) 7 months ago MS\_FSRVP added DCERPC mode (#56) 7 months ago MS\_RPRNMS-SCMR: Service Control Manager Remote ProtocolROpenSCManager(A/W)/ROpenSCManager2RCreateService(A/W)/RCreateServiceWOW64(A/W)/RCreateWowServiceMS-DRSR: Directory Replication Service Remote ProtocolNetrWkstaGetInfoNetrWkstaUserEnumNetwork connection to pipe \pipe\wkssvcMS-RRP: Windows Remote Registry Remote Protocol Network: Methods: BaseRegCreateKey BaseRegQueryInfoKey BaseRegSetValue Host: Inbound network connection to: System over \pipe\winregMS-TSCH: Task Scheduler Service Remoting Protocol Server Binary: ATSvc/SASec:taskcomp.dll (loads into) svchost.exe ITaskSchedulerServiceschedsvc.dll (loads into) svchost.exe Endpoint: ATSvc/SASec:ncacn\_np: \pipe\atsvc ITaskSchedulerService:ncacn\_ip\_tcp ncacn\_np: \pipe\atsvcMS-WKST: Workstation Service Remote Protocol Server Binary: wkssvc.dll (loads into) svchost.exe Endpoint: ncacn\_np: \PIPE\wkssvcMS-SRVS: Server Service Remote Protocol Server Binary: srvsvc.dll (loads into) svchost.exe Endpoint: ncacn\_np: \PIPE\srvsvcMS-RPRN-MS-PAR: Print System Remote Protocol / Print System Asynchronous Remote Protocol Server Binary: spoolsv.exe Endpoint: ncacn\_np: \pipe\spoolss (MS-RPRN) ncacn\_ip\_tcp (dynamic endpoint) (MS-PAR)MS-SAMR: Security Account Manager Remote Protocol Server Binary: samsrv.dll (loads into) lsass.exe Endpoint: ncacn\_ip\_tcp ncacn\_np: \PIPE\lsass alias \pipe\samrMS-LSAD - MS-LSAT: Local Security Authority (Domain Policy) Remote Protocol / Local Security Authority (Translation Methods) Remote ProtocolServer Binary: lsarpc.dll (loads into) lsass.exe Endpoint: ncacn\_ip\_tcp ncacn\_np: \PIPE\lsass alias \pipe\lsarpcMS-EFSR: Encrypting File System Remote (EFSRPC) Protocol Indicator of Activity (IOA): PetitPotam: Network:Inbound network connection over port 445Connection over pipe lsarpc or lsass (lsarpc is points to lsass)Connection over pipe efsrpcMethods:EfsRpcOpenFileRaw (patched by Microsoft via CVE-2021-36942) EfsRpcEncryptFileSrv EfsRpcDecryptFileSrv EfsRpcQueryUsersOnFile EfsRpcQueryRecoveryAgents EfsRpcRemoveUsersFromFile EfsRpcAddUsersToFile Host:(Server Side + Attack came from non-domain joined host): Event ID 5145 on Target:ANONYMOUS LOGON Account Domain: NT AUTHORITY Object Type: File Share Name: \\\*\IPC$ Relative Target Name: lsarpc Access Mask: 0x3 Accesses: ReadData (or ListDirectory) WriteData (or AddFile) Event ID 4624 on Target:Logon Type: 3 Account Name: Anonymous Logon Account Domain: NT SECURITY Logon Process: NtLmSsp For version where the source host is a domain joined host, the data will be similar except 4624 logon will be a domain user over NTLM. Join LogonID from 4624 with LogonID on 5145

* MS-NRPC: Netlogon Remote Protocol Network:

Method (either over TCP or named pipe - lsass/netlogon): NetrServerAuthenticate2/3 (high volume) NetrServerPasswordSet2 NetrServerReqChallenge (high volume) NetrLogonSamLogonWithFlags DRS Methods (DrsGetNCChanges) (Zerologon attack specific) Host:Window Security Event - 4624Anonymous Logon or DC Computer Account Logon Type 3 Auth Package: NTLM Logon Process: NtLmSsp Source Network Address & Workstation Name will show source Logon ID tie to other events (4742) Window Security Event - 4742:Look for password last set on DCs Account Name is DC Machine Account Security ID - same as 4624 Tie Logon ID to 4624

* MS-FSRVP: File Server Remote VSS Protocol Indicator of Activity (IOA): Network:

NTLM Authentication requests (zeek - ntlm.log) RPC Methods:IsPathSupported IsPathShadowCopied Host:Inbound connection over port 445 to System process (WSE - 5156 + Sysmon - 3) Pipe connection \FssagentRpc from System process (Sysmon - 18) fssagent.dll loaded into svchost.exe (Sysmon -7) LogonEvent LogonType: 3 Elevated Token: Yes Account Name: LogonProcess: NtlmSsp Auth Package: NTLM Network Share Event: Account Name: (same logon id as logon event) Object Type: File Share Name \\\*\IPC$ Relative Target Name: FssagentRpc AccessMask: 0x3 Accesses: ReadData (or ListDirectory) WriteData (or AddFile)

* MS-DFSNM: Distributed File System (DFS): Namespace Management Protocol Indicator of Activity (IOA): Network:

Inbound network connection over port 445 to the System Process (PID=4)Connection over pipe netdfsMethods:NetrDfsRemoveStdRoot (potentially more, only tested method) Host:(Server Side):Event ID 5156Account Name: domain userObject Type: FileShare Name: \\\*\IPC$Relative Target Name: netdfsAccess Mask: 0x12019FSource Address: Address of where request is coming from. Good for context during investigation.Accesses:ReadData (or ListDirectory) WriteData (or AddFile) Event ID 4624Logon Type: 3 Account Name: domain user Process ID: 0x0 Elevated Token: Yes Authentication Package: NTLM (by defualt of PoC, subject to change and could be Kerberos) Join on LogonID for queries.
